<html>
<head>
    <style>
         body{
             background: linear-gradient(to right, #1D1A1C, #50093C, #4F02A1);
         }
        .video-content{
            width: 600px;
            text-align: center;
            left: auto;
            height: 400px;
        }
        #myvideo{
            background: black;
            text-align: center;
            margin-left: 333px;
        }
        #desc{
            color: white;
            margin-left: 333px;
        }
        .img-content{
            width: 100px;
           height: 100px;
            float: left;
            margin-top: 10px;
            margin-left: 10px;
        }
        .text-content{
            color: white;
            left: -23px;
            float: left;
            font-size: 30;
            margin-top: 40px;
        }
        .btn-content{
            position: absolute;
            margin-top: 116px;
        }
         input{
             color: #fff;
             padding: 3px 20px;
             font-size: 16px;
             border-radius: 5px;
             margin-left: 10px;
             background-color: #0fc30f;
             border: none;
         }
        .dealtail-content{
            position: absolute;
            margin-top: 141px;
            left: 340px;
            color: #ae388e;
        }

        .td-content{
            color: #ae388e;
        }
        .table-content{
            color: white;
        }
    </style>
</head>

<body>
<div class="video-content">
    <img class="img-content" src="../images/1111.png" alt="">
    <span class="text-content">小音符</span>
    <video  id="myvideo" width="100%" height="100%" controls="controls" >
        你的浏览器不支持HTML5播放此视频
        <span style="white-space:pre">	</span><!-- 支持播放的文件格式 -->
        <source src="" type='video/mp4' webkit-playsinline="true" playsinline="true"/>
    </video>
</div>
<div class="btn-content">
    <span id="desc"></span>
    <input type="button" name="" value="上一个" onclick="preVideo()">
    <input type="button" name="" value="下一个" onclick="nextVideo()">
</div>

<div class="dealtail-content">
    <table class="table-content">
        <tr>
            <td><img id="headImgUrl" style="height: 50px;width: 50px;" src=""></td>
            <td class="td-content">
                <span id="unqueId"></span><br/>
                <a onclick="ownDeatil()"><span id="nickname"></span></a><br/>
                <span id="gender"></span>
            </td>
        </tr>
    </table>
    <input type="hidden" id="userId" />
   <table class="table-content">
       <tr>
           <td>点赞数：</td>
           <td id="diggCount"></td>
       </tr>
       <tr>
           <td>评论数：</td>
           <td id="CommentCount"></td>
       </tr>
       <tr>
           <td>分享数：</td>
           <td id="shareCount"></td>
       </tr>
   </table>
</div>


<script language="javascript" src="../js/jquery.min.js"></script>
<script language="javascript">
    var requestCount = 1;
    $(function () {
        loadData(requestCount);
    })
    $(document).ready(function(){
        video.play();
    });
    var vList = []; // 初始化播放列表
    var curr = 0;
    var video = document.getElementById("myvideo");
    video.addEventListener('ended', function(){
        play();
    });

    function firstPlay() {
        video.src = vList[curr].videoUrl;
        showdetail(vList[curr]);
    }

    function play() {
        video.src = vList[curr].videoUrl;
        showdetail(vList[curr]);
        curr++;
        if(curr >= vList.length){
            requestCount++;
            loadData(requestCount);
            curr = 0; //重新循环播放
        }
    }
    
    function loadData(page) {
        vList = [];
        $.ajax({
            url: "/qiantai/findVideoListdouyi",
            type: "get",
            dataType: "json",
            data: {
                 'page': page,
             },
            success: function (result) {
                var list = result.data;
                list.forEach(function (item,index) {
                    vList.push(item);
                })
                firstPlay();
                console.log(vList)
            }
        });
    }

    //上一个
    function preVideo() {
        if(curr > 0){
            video.src = vList[curr-1].videoUrl;
            showdetail(vList[curr-1]);
            curr--;
        }
    }
    //下一个
    function nextVideo() {
        if(curr < vList.length-1){
            video.src = vList[curr+1].videoUrl;
            showdetail(vList[curr+1]);
            curr++;
        }else {
            requestCount++;
            loadData(requestCount);
            curr = 0;
        }
    }

    function showdetail(vList) {
        var descArr = vList.desc.split("#");
        console.log(descArr.length);
        var desc = "";
        if(descArr.length == 2){
            desc ="#" + descArr[1]+"" + descArr[0].substring(0,descArr[0].length-1);
        }else if(descArr.length == 1){
            desc = descArr[0];
        }
        $("#desc").text(desc);
        $("#userId").val(vList.userId);
        $("#diggCount").text(vList.diggCount);
        $("#CommentCount").text(vList.commentCount);
        $("#shareCount").text(vList.shareCount);
        var author = vList.author;
        $("#headImgUrl").attr('src',author.headImgUrl);
        $("#unqueId").text(author.uniqueId);
        $("#nickname").text(author.nickname);
        $("#gender").text(author.gender == 1 ? "男":"女");
        video.load();
        video.play();
    }


    function ownDeatil() {
        var userId = $("#userId").val();
       window.open("https://www.douyin.com/share/user/"+userId+"?share_type=link")
    }
</script>
</body>
</html>